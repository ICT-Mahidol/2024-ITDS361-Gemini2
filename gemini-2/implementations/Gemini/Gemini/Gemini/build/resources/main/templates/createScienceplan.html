<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Create Science Plan</title>
</head>
<body>
<h1>Create Science Plan</h1>
<form id="sciencePlanForm">
  <label>Creator: <input type="text" name="creator" required></label><br>
  <label>Submitter: <input type="text" name="submitter" required></label><br>
  <label>Funding (USD): <input type="number" name="fundingInUSD" step="0.01" required></label><br>
  <label>Objectives: <textarea name="objectives" required></textarea></label><br>
  <label>Star System: <input type="text" name="starSystem" required></label><br>
  <label>Start Date: <input type="datetime-local" name="startDate" required></label><br>
  <label>End Date: <input type="datetime-local" name="endDate" required></label><br>
  <label>Telescope Location:
    <select name="telescopeLocation" required>
      <option value="HAWAII">Hawaii</option>
      <option value="CHILE">Chile</option>
    </select>
  </label><br>

  <h2>Data Processing Requirement</h2>
  <label>File Type: <input type="text" name="dataProcRequirement.fileType" required></label><br>
  <label>File Quality: <input type="text" name="dataProcRequirement.fileQuality" required></label><br>
  <label>Color Type: <input type="text" name="dataProcRequirement.colorType" required></label><br>
  <label>Contrast: <input type="number" name="dataProcRequirement.contrast" step="0.01" required></label><br>
  <label>Brightness: <input type="number" name="dataProcRequirement.brightness" step="0.01" required></label><br>
  <label>Saturation: <input type="number" name="dataProcRequirement.saturation" step="0.01" required></label><br>
  <label>Highlights: <input type="number" name="dataProcRequirement.highlights" step="0.01" required></label><br>
  <label>Exposure: <input type="number" name="dataProcRequirement.exposure" step="0.01" required></label><br>
  <label>Shadows: <input type="number" name="dataProcRequirement.shadows" step="0.01" required></label><br>
  <label>Whites: <input type="number" name="dataProcRequirement.whites" step="0.01" required></label><br>
  <label>Blacks: <input type="number" name="dataProcRequirement.blacks" step="0.01" required></label><br>
  <label>Luminance: <input type="number" name="dataProcRequirement.luminance" step="0.01" required></label><br>
  <label>Hue: <input type="number" name="dataProcRequirement.hue" step="0.01" required></label><br>

  <button type="submit">Submit</button>
</form>

<script>
  document.getElementById('sciencePlanForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const formData = new FormData(e.target);

      // ฟังก์ชันแปลงวันที่จาก `yyyy-MM-ddTHH:mm` เป็น `dd/MM/yyyy HH:mm:ss`
      function formatDate(dateString) {
          const date = new Date(dateString);
          const day = String(date.getDate()).padStart(2, '0');
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const year = date.getFullYear();
          const hours = String(date.getHours()).padStart(2, '0');
          const minutes = String(date.getMinutes()).padStart(2, '0');
          const seconds = String(date.getSeconds()).padStart(2, '0');

          return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
      }

      const data = {
          creator: formData.get('creator'),
          submitter: formData.get('submitter'),
          fundingInUSD: parseFloat(formData.get('fundingInUSD')),
          objectives: formData.get('objectives'),
          starSystem: formData.get('starSystem'),
          startDate: formatDate(formData.get('startDate')), // แปลงวันที่
          endDate: formatDate(formData.get('endDate')),     // แปลงวันที่
          telescopeLocation: formData.get('telescopeLocation'),
          dataProcRequirement: {
              fileType: formData.get('dataProcRequirement.fileType'),
              fileQuality: formData.get('dataProcRequirement.fileQuality'),
              colorType: formData.get('dataProcRequirement.colorType'),
              contrast: parseFloat(formData.get('dataProcRequirement.contrast')),
              brightness: parseFloat(formData.get('dataProcRequirement.brightness')),
              saturation: parseFloat(formData.get('dataProcRequirement.saturation')),
              highlights: parseFloat(formData.get('dataProcRequirement.highlights')),
              exposure: parseFloat(formData.get('dataProcRequirement.exposure')),
              shadows: parseFloat(formData.get('dataProcRequirement.shadows')),
              whites: parseFloat(formData.get('dataProcRequirement.whites')),
              blacks: parseFloat(formData.get('dataProcRequirement.blacks')),
              luminance: parseFloat(formData.get('dataProcRequirement.luminance')),
              hue: parseFloat(formData.get('dataProcRequirement.hue')),
          }
      };

      fetch('/scienceplans', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
      })
      .then(response => {
          if (!response.ok) throw new Error('Failed to create Science Plan');
          return response.text();
      })
      .then(result => alert('Success: ' + result))
      .catch(error => alert('Error: ' + error.message));
  });
</script>
</body>
</html>
